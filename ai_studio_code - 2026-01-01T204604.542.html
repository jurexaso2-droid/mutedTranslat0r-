<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASL Alphabet Translator (A-Z)</title>
    
    <!-- Load MediaPipe Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>

    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: #111827;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        h1 { color: #34d399; margin-bottom: 5px; }
        .subtitle { color: #9ca3af; margin-bottom: 25px; font-size: 0.9rem; }

        .container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
            width: 100%;
            max-width: 1200px;
        }

        .video-wrapper {
            position: relative;
            border: 3px solid #3b82f6;
            border-radius: 12px;
            overflow: hidden;
            width: 640px;
            height: 480px;
            background: #000;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
        }

        video, canvas {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            transform: scaleX(-1); /* Mirror view */
        }

        .panel {
            flex: 1;
            min-width: 300px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .result-card {
            background: #1f2937;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid #374151;
        }

        .letter-display {
            font-size: 6rem;
            font-weight: 800;
            color: #fbbf24;
            text-shadow: 0 0 20px rgba(251, 191, 36, 0.3);
            min-height: 120px;
        }

        .status { color: #6b7280; font-size: 0.9rem; }

        .rules-card {
            background: #1f2937;
            padding: 15px;
            border-radius: 12px;
            font-size: 0.85rem;
            color: #d1d5db;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .rules-card h3 { margin-top: 0; color: #60a5fa; }
        .rules-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
        }

        /* Demo Graphic for "A" */
        .demo-visual {
            margin-top: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        .fist-icon {
            width: 60px;
            height: 70px;
            background: #fca5a5;
            border-radius: 10px;
            position: relative;
            border: 2px solid #fff;
        }
        .fist-thumb {
            position: absolute;
            width: 15px;
            height: 40px;
            background: #fca5a5;
            right: -8px;
            top: 15px;
            border: 2px solid #fff;
            border-radius: 5px;
        }

        .loading-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
            color: white;
            font-size: 1.2rem;
        }
    </style>
</head>
<body>

    <h1>üñêÔ∏è ASL Translator (A-Z)</h1>
    <div class="subtitle">Use your <b>Right Hand</b>. Ensure good lighting.</div>

    <div class="container">
        <!-- Camera Section -->
        <div class="video-wrapper">
            <div class="loading-overlay" id="loading">Initializing AI... Please wait...</div>
            <video id="input_video" playsinline></video>
            <canvas id="output_canvas"></canvas>
        </div>

        <!-- Output Section -->
        <div class="panel">
            <div class="result-card">
                <h2>Translation</h2>
                <div class="letter-display" id="output">--</div>
                <div class="status" id="debug-status">Waiting for hand...</div>
            </div>

            <div class="rules-card">
                <h3>Letter Guide (Quick Tips)</h3>
                <div class="demo-visual">
                    <div style="font-weight:bold; margin-bottom:5px;">Demo: Letter "A"</div>
                    <div class="fist-icon"><div class="fist-thumb"></div></div>
                    <small>Fist with thumb on side</small>
                </div>
                <hr style="border-color:#374151; margin: 15px 0;">
                <div class="rules-grid">
                    <div><b>A:</b> Fist, thumb side</div>
                    <div><b>B:</b> Open palm, thumb in</div>
                    <div><b>C:</b> C-Shape</div>
                    <div><b>D:</b> Index up, loop</div>
                    <div><b>E:</b> Claw fingers</div>
                    <div><b>F:</b> OK sign</div>
                    <div><b>I:</b> Pinky up</div>
                    <div><b>L:</b> L-Shape</div>
                    <div><b>O:</b> Circle</div>
                    <div><b>V:</b> Peace sign</div>
                    <div><b>W:</b> 3 fingers up</div>
                    <div><b>Y:</b> Hang loose</div>
                </div>
                <p style="margin-top:10px; font-size:0.8rem; color:#9ca3af;">
                    *Note: M, N, S, T are very similar. Adjust thumb position slightly to detect.
                </p>
            </div>
        </div>
    </div>

    <script>
        const videoElement = document.getElementById('input_video');
        const canvasElement = document.getElementById('output_canvas');
        const canvasCtx = canvasElement.getContext('2d');
        const outputText = document.getElementById('output');
        const debugText = document.getElementById('debug-status');
        const loadingScreen = document.getElementById('loading');

        canvasElement.width = 640;
        canvasElement.height = 480;

        // --- GESTURE LOGIC ---
        // We use geometric rules based on finger landmarks
        function predictLetter(lm) {
            // lm = landmarks array (0-20)
            
            // 1. Detect which fingers are open
            // Finger Tips: Thumb=4, Index=8, Middle=12, Ring=16, Pinky=20
            // Finger PIP (Lower Joint): Index=6, Middle=10, Ring=14, Pinky=18
            // Thumb is special: check Tip vs IP (3) or x-coordinate
            
            const thumbOpen = lm[4].x < lm[3].x; // For right hand, thumb moves left to open
            const indexOpen = lm[8].y < lm[6].y;
            const middleOpen = lm[12].y < lm[10].y;
            const ringOpen = lm[16].y < lm[14].y;
            const pinkyOpen = lm[20].y < lm[18].y;

            // Finger Counters
            const fingersOpenCount = [indexOpen, middleOpen, ringOpen, pinkyOpen].filter(Boolean).length;
            
            // --- ALPHABET LOGIC (Rule Based) ---
            
            // B: All 4 fingers up, thumb tucked or up
            if (indexOpen && middleOpen && ringOpen && pinkyOpen) {
                // If fingers are spread wide, it's 5 or B
                return "B"; 
            }

            // A: Fist, Thumb on side
            // E: Fist, Thumb tucked under
            // S: Fist, Thumb over fingers
            // M: Fist, Thumb between Ring/Pinky (hard to see) -> 3 fingers over thumb
            // N: Fist, Thumb between Middle/Ring -> 2 fingers over thumb
            // T: Fist, Thumb between Index/Middle -> 1 finger over thumb
            
            if (fingersOpenCount === 0) {
                // All fingers closed (Fist-like)
                
                // Check Thumb Position for A vs E vs S
                // A: Thumb tip is high up
                if (lm[4].y < lm[8].y) { 
                    return "A"; 
                }
                
                // S: Thumb tip is crossing the fingers (X coordinate is in the middle of palm)
                // This is hard, we default to E or S based on thumb tip x
                if (lm[4].x > lm[6].x) { 
                    return "S"; 
                }
                
                return "E"; // Default curled fist
            }

            // D: Index Up, others curled (Circle with thumb/middle)
            if (indexOpen && !middleOpen && !ringOpen && !pinkyOpen) {
                // Check if it's D or Z or 1
                return "D";
            }

            // I: Pinky Up
            if (!indexOpen && !middleOpen && !ringOpen && pinkyOpen) {
                // J involves motion, we return I/J
                return "I"; 
            }

            // Y: Thumb + Pinky Up
            if (thumbOpen && !indexOpen && !middleOpen && !ringOpen && pinkyOpen) {
                return "Y";
            }

            // L: Thumb + Index
            if (thumbOpen && indexOpen && !middleOpen && !ringOpen && !pinkyOpen) {
                return "L";
            }

            // V: Index + Middle
            if (indexOpen && middleOpen && !ringOpen && !pinkyOpen) {
                // K checks: Thumb is inside the V
                // Assuming V for simplicity
                return "V";
            }

            // W: Index + Middle + Ring
            if (indexOpen && middleOpen && ringOpen && !pinkyOpen) {
                // F is often similar if the circle is perfect, but usually F is "OK sign"
                // Check F: Index and Thumb touching
                let dist = Math.hypot(lm[8].x - lm[4].x, lm[8].y - lm[4].y);
                if(dist < 0.05) return "F";
                return "W";
            }

            // F: OK Sign (Index+Thumb touch, others open)
            // But usually the others are open. If we detected 3 open above (Mid, Ring, Pinky)
            if (!indexOpen && middleOpen && ringOpen && pinkyOpen) {
                 return "F";
            }

            // C: Hand shaped like C
            // All fingers slightly curved, not fully open, not fully closed.
            // This is tricky. We check x-distance of thumb vs index
            if (lm[8].x - lm[4].x < 0.1 && fingersOpenCount > 2) {
                // If the gap is small horizontally but fingers aren't fully vertical
                // return "C";
            }
            
            // O: Thumb touches Index Tip, fingers curled
            // Check distance thumb tip to index tip
            let distO = Math.hypot(lm[8].x - lm[4].x, lm[8].y - lm[4].y);
            if (distO < 0.08 && !middleOpen && !ringOpen && !pinkyOpen) {
                return "O";
            }
            
            // U: Index + Middle together (Upright)
            // Same as V but distance is small.
            if (indexOpen && middleOpen && !ringOpen && !pinkyOpen) {
                let distUV = Math.hypot(lm[8].x - lm[12].x, lm[8].y - lm[12].y);
                if (distUV < 0.04) return "U";
            }
            
            // G & H (Horizontal fingers)
            // These require checking the angle of the wrist or finger vector
            // Hard in basic mode.

            // H: Index + Middle horizontal
            // G: Index horizontal

            // Catch-all/Refinements
            if (!indexOpen && !middleOpen && !ringOpen && !pinkyOpen && thumbOpen) {
                // Only thumb?
                return "A"; // Often A is just thumb up
            }

            return "--";
        }

        // --- MEDIAPIPE SETUP ---
        function onResults(results) {
            loadingScreen.style.display = 'none';
            canvasCtx.save();
            canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
            canvasCtx.drawImage(results.image, 0, 0, canvasElement.width, canvasElement.height);

            if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                // We only look at the first detected hand
                const landmarks = results.multiHandLandmarks[0];

                // Draw Skeleton
                drawConnectors(canvasCtx, landmarks, HAND_CONNECTIONS, {color: '#34d399', lineWidth: 4});
                drawLandmarks(canvasCtx, landmarks, {color: '#fbbf24', lineWidth: 2, radius: 4});

                // Detect Letter
                const letter = predictLetter(landmarks);
                
                // Update UI
                outputText.innerText = letter;
                if(letter !== "--") {
                    debugText.innerText = "Gesture Detected";
                    debugText.style.color = "#34d399";
                } else {
                    debugText.innerText = "Position hand clearly...";
                    debugText.style.color = "#fbbf24";
                }

            } else {
                outputText.innerText = "--";
                debugText.innerText = "No hand detected";
                debugText.style.color = "#ef4444";
            }
            canvasCtx.restore();
        }

        const hands = new Hands({locateFile: (file) => {
            return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
        }});

        hands.setOptions({
            maxNumHands: 1,
            modelComplexity: 1,
            minDetectionConfidence: 0.6,
            minTrackingConfidence: 0.6
        });

        hands.onResults(onResults);

        const camera = new Camera(videoElement, {
            onFrame: async () => {
                await hands.send({image: videoElement});
            },
            width: 640,
            height: 480
        });

        camera.start();
    </script>
</body>
</html>